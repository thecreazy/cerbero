!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).cerbero=t()}(this,(function(){"use strict";var e,t,n,i,r,o=(e="web-worker-0.js",function(t){return new Worker(e,t)}),a=function(e,t){return{name:e,value:void 0===t?-1:t,delta:0,entries:[],id:"v2-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)}},s=function(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){if("first-input"===e&&!("PerformanceEventTiming"in self))return;var n=new PerformanceObserver((function(e){return e.getEntries().map(t)}));return n.observe({type:e,buffered:!0}),n}}catch(e){}},c=function(e,t){var n=function n(i){"pagehide"!==i.type&&"hidden"!==document.visibilityState||(e(i),t&&(removeEventListener("visibilitychange",n,!0),removeEventListener("pagehide",n,!0)))};addEventListener("visibilitychange",n,!0),addEventListener("pagehide",n,!0)},u=function(e){addEventListener("pageshow",(function(t){t.persisted&&e(t)}),!0)},l=function(e,t,n){var i;return function(r){t.value>=0&&(r||n)&&(t.delta=t.value-(i||0),(t.delta||void 0===i)&&(i=t.value,e(t)))}},f=-1,d=function(){return"hidden"===document.visibilityState?0:1/0},m=function(){c((function(e){var t=e.timeStamp;f=t}),!0)},v=function(){return f<0&&(f=d(),m(),u((function(){setTimeout((function(){f=d(),m()}),0)}))),{get firstHiddenTime(){return f}}},p=function(e,t){var n,i=v(),r=a("FCP"),o=function(e){"first-contentful-paint"===e.name&&(f&&f.disconnect(),e.startTime<i.firstHiddenTime&&(r.value=e.startTime,r.entries.push(e),n(!0)))},c=performance.getEntriesByName&&performance.getEntriesByName("first-contentful-paint")[0],f=c?null:s("paint",o);(c||f)&&(n=l(e,r,t),c&&o(c),u((function(i){r=a("FCP"),n=l(e,r,t),requestAnimationFrame((function(){requestAnimationFrame((function(){r.value=performance.now()-i.timeStamp,n(!0)}))}))})))},h=!1,g=-1,w={passive:!0,capture:!0},T=new Date,b=function(e,r){t||(t=r,n=e,i=new Date,y(removeEventListener),E())},E=function(){if(n>=0&&n<i-T){var e={entryType:"first-input",name:t.type,target:t.target,cancelable:t.cancelable,startTime:t.timeStamp,processingStart:t.timeStamp+n};r.forEach((function(t){t(e)})),r=[]}},S=function(e){if(e.cancelable){var t=(e.timeStamp>1e12?new Date:performance.now())-e.timeStamp;"pointerdown"==e.type?function(e,t){var n=function(){b(e,t),r()},i=function(){r()},r=function(){removeEventListener("pointerup",n,w),removeEventListener("pointercancel",i,w)};addEventListener("pointerup",n,w),addEventListener("pointercancel",i,w)}(t,e):b(t,e)}},y=function(e){["mousedown","keydown","touchstart","pointerdown"].forEach((function(t){return e(t,S,w)}))},k=new Set,_={timeInPage:"timeInPage",selection:"selection",scroll:"scroll",mouseExit:"mouseExit",performance:"performance",click:"click",webVitals:"webVitals"},L=function(){return(L=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},I=function(e){var t=e.id;return e.nodeName.toLowerCase()+(t?"#"+t:"")},W=function(e){var t="";return e.parentElement&&(t=W(e.parentElement)),t+" > "+I(e)},P=function(e){var t=e.id,n=e.name,i=e.nodeName,r=e.constructor,o=e.className,a=e.getBoundingClientRect,s={id:t,name:n,className:o,type:i,domType:r.name||"",identifier:I(e),domStructure:W(e),position:a?e.getBoundingClientRect():{}};return e.data&&(s.data=e.data),e.wholeText&&(s.wholeText=e.wholeText),e.nodeValue&&(s.nodeValue=e.nodeValue),e.textContent&&(s.textContent=e.textContent),s},x=function(e){var t,n={},i=window.InputDeviceCapabilities,r=void 0===i?Window:i;for(var o in e)e[o]&&"MemoryInfo"===e[o].constructor.name?n[o]={totalJSHeapSize:(t=e[o]).totalJSHeapSize,usedJSHeapSize:t.usedJSHeapSize,jsHeapSizeLimit:t.jsHeapSizeLimit}:e[o]instanceof Node?n[o]=P(e[o]):e[o]instanceof Window?n[o]="Window":e[o]instanceof r==!1&&"function"!=typeof e[o]&&(n[o]=e[o]);return n.path=null,L({},n)},H=function(e){var t=this;this.cb=function(e){return null},this.selection="",this.getSelectionText=function(){return window.getSelection().toString()},this.observerValue=function(){var e=t.getSelectionText();e!==t.selection&&""!==e&&(t.selection=e,t.cb({event:window.getSelection(),text:t.selection}))},this.cb=e,this.observerValue=this.observerValue.bind(this),setInterval(this.observerValue,2e3)};return new function(){var e=this;if(this.textEncoder=new TextEncoder,this.timeInPageIntervalTime=2500,this.addEventListner=function(t){e.cb=t},this.setTimeInPageInterval=function(t){e.timeInPageIntervalTime=t,clearInterval(e.timeInPageInterval),e.timeInPageInterval=setInterval(e._timeOnPage,e.timeInPageIntervalTime)},this._sendToWorker=function(t,n,i){void 0===i&&(i=!0);var r=i?x(n):n;r.startDate=e.startDate,r=e.textEncoder.encode(JSON.stringify(r)),e.cerberoWorker.postMessage({type:t,event:r})},this._receiveWorkerMessage=function(t){if(!e.cb)throw new Error("[Cerbero] no callback setted");e.cb.apply(null,[t.data])},this._receiveSelectionEvent=function(t){e._sendToWorker(_.selection,{event:x(t.event),selection:t.text},!1)},this._receiveScrollEvent=function(t){var n=document.body,i=document.documentElement;window.clearTimeout(e.isScrolling),e.isScrolling=setTimeout((function(){var r=Math.max(n.scrollHeight,n.offsetHeight,i.clientHeight,i.scrollHeight,i.offsetHeight);e._sendToWorker(_.scroll,{event:x(t),height:r,scroll:window.scrollY||window.pageYOffset},!1)}),100)},this._receiveMouseOutEvent=function(t){var n=t.toElement;n&&"HTML"!==n.nodeName||"HTML"===t.fromElement.nodeName||e._sendToWorker(_.mouseExit,t)},this._timeOnPage=function(){e._sendToWorker(_.timeInPage,{startTime:e.startDate,nowTime:Date.now()})},this._initListener=function(){e._sendToWorker(_.performance,window.performance),function(e,t){h||(p((function(e){g=e.value})),h=!0);var n,i=function(t){g>-1&&e(t)},r=a("CLS",0),o=0,f=[],d=function(e){if(!e.hadRecentInput){var t=f[0],i=f[f.length-1];o&&e.startTime-i.startTime<1e3&&e.startTime-t.startTime<5e3?(o+=e.value,f.push(e)):(o=e.value,f=[e]),o>r.value&&(r.value=o,r.entries=f,n())}},m=s("layout-shift",d);m&&(n=l(i,r,t),c((function(){m.takeRecords().map(d),n(!0)})),u((function(){o=0,g=-1,r=a("CLS",0),n=l(i,r,t)})))}((function(t){return e._sendToWorker(_.webVitals,t)})),p((function(t){return e._sendToWorker(_.webVitals,t)})),function(e,i){var o,f=v(),d=a("FID"),m=function(e){e.startTime<f.firstHiddenTime&&(d.value=e.processingStart-e.startTime,d.entries.push(e),o(!0))},p=s("first-input",m);o=l(e,d,i),p&&c((function(){p.takeRecords().map(m),p.disconnect()}),!0),p&&u((function(){var s;d=a("FID"),o=l(e,d,i),r=[],n=-1,t=null,y(addEventListener),s=m,r.push(s),E()}))}((function(t){return e._sendToWorker(_.webVitals,t)})),function(e,t){var n,i=v(),r=a("LCP"),o=function(e){var t=e.startTime;t<i.firstHiddenTime&&(r.value=t,r.entries.push(e)),n()},f=s("largest-contentful-paint",o);if(f){n=l(e,r,t);var d=function(){k.has(r.id)||(f.takeRecords().map(o),f.disconnect(),k.add(r.id),n(!0))};["keydown","click"].forEach((function(e){addEventListener(e,d,{once:!0,capture:!0})})),c(d,!0),u((function(i){r=a("LCP"),n=l(e,r,t),requestAnimationFrame((function(){requestAnimationFrame((function(){r.value=performance.now()-i.timeStamp,k.add(r.id),n(!0)}))}))}))}}((function(t){return e._sendToWorker(_.webVitals,t)})),function(e){var t,n=a("TTFB");t=function(){try{var t=performance.getEntriesByType("navigation")[0]||function(){var e=performance.timing,t={entryType:"navigation",startTime:0};for(var n in e)"navigationStart"!==n&&"toJSON"!==n&&(t[n]=Math.max(e[n]-e.navigationStart,0));return t}();if(n.value=n.delta=t.responseStart,n.value<0)return;n.entries=[t],e(n)}catch(e){}},"complete"===document.readyState?setTimeout(t,0):addEventListener("pageshow",t)}((function(t){return e._sendToWorker(_.webVitals,t)})),document.addEventListener("click",(function(t){return e._sendToWorker("click",t)})),window.addEventListener("mouseout",e._receiveMouseOutEvent,!1),new H(e._receiveSelectionEvent),window.addEventListener("scroll",e._receiveScrollEvent,!1),e.cerberoWorker.onmessage=e._receiveWorkerMessage,e.timeInPageInterval=setInterval(e._timeOnPage,e.timeInPageIntervalTime)},"undefined"==typeof Worker)return null;this.startDate=Date.now(),this.cerberoWorker=new o,this._initListener=this._initListener.bind(this),this._sendToWorker=this._sendToWorker.bind(this),this._receiveWorkerMessage=this._receiveWorkerMessage.bind(this),this._receiveSelectionEvent=this._receiveSelectionEvent.bind(this),this._timeOnPage=this._timeOnPage.bind(this),this._initListener()}}));
